<div class="grid-container">
    <h1 class="mat-h1">Project Details : {{planningApp.planningReferenceId}}</h1>
    <div class="mat-elevation-z8">
      <mat-tab-group>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">trending_up</mat-icon>
            Application Progress
          </ng-template>
          <div class="grid-container">
              <h1 class="mat-h1">Application State Transitions</h1>
              <div class="mat-elevation-z8">
            
              <table mat-table #table [dataSource]="planningApp.planningAppStates" matSort aria-label="Elements">
            
               <!-- IconStatus --> 
               <ng-container matColumnDef="iconStatus">
                  <th mat-header-cell flex="50px" *matHeaderCellDef mat-sort-header ></th>
                  <mat-cell *matCellDef="let row" flex="50px">
                    <div *ngIf="row.stateStatus=='Complete'"><mat-icon class="green-thumb-icon">check_circle</mat-icon></div>
                    <div *ngIf="row.stateStatus=='OnTime'"><mat-icon class="blue-thumb-icon">thumb_up</mat-icon></div>
                    <div *ngIf="row.stateStatus=='Due'"><mat-icon class="orange-warn-icon">report</mat-icon></div>
                    <div *ngIf="row.stateStatus=='Overdue'"><mat-icon class="red-warn-icon">report</mat-icon></div>
                    <div *ngIf="row.stateStatus=='Overran'"><mat-icon class="red-warn-icon">thumb_down</mat-icon></div>
                  </mat-cell>
                </ng-container>
            
                <!-- State Name -->
                <ng-container matColumnDef="stateName" >
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>State Name</th>
                  <td mat-cell *matCellDef="let row">{{row.stateName}}</td>
                </ng-container>
 
                <ng-container matColumnDef="dueByDate">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Due By Date</th>
                  <td mat-cell *matCellDef="let row" 
                      [ngClass]="{'isCustomDuration':row.isCustomDuraton==true}">{{ row.dueByDate }}
                  </td>          
                </ng-container>
              
                <ng-container matColumnDef="dateCompleted">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Date Completed</th>
                    <td mat-cell *matCellDef="let row">{{row.dateCompleted}}</td>
                </ng-container>
            
                <ng-container matColumnDef="stateStatus">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header>State Status</th>
                    <td mat-cell *matCellDef="let row">{{row.stateStatus}}</td>
                  </ng-container>

                <ng-container matColumnDef="edit">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header></th>   
                    <td 
                        mat-cell *matCellDef="let row" matTooltip="Edit State" [routerLink]="['/appstate/edit/', row.id]" [skipLocationChange]="true" [queryParams]="{ planningAppId: planningApp.id }"><span><mat-icon [ngClass]="{'red-warn-edit-icon':row.mandatoryFieldsSet==false}">edit</mat-icon></span>
                    </td>
                </ng-container>

                <ng-container matColumnDef="nextState">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header></th>
                    <mat-cell *matCellDef="let row">
                      <div *ngIf="row.currentState==false">
                          <td mat-cell ></td>
                      </div>
                      <div *ngIf="row.currentState==true">
                          <td mat-cell >
                              <button mat-mini-fab color="primary"  matTooltip="Go to next state" (click)="nextState()"><span><mat-icon>archive</mat-icon></span></button>
                          </td>                     
                      </div>
                    </mat-cell>            
                  </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedStateColumns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedStateColumns;" [ngClass] = "{'highlight' : row.currentState == true}"></tr>
              </table>
  
            </div>
            </div>
        </mat-tab>  

        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">ballot</mat-icon>
            Application Details
          </ng-template>
          <div class="grid-container">
              <mat-accordion class="example-headers-align">
                  <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle>
                    <mat-expansion-panel-header>
                      <mat-panel-title>Application Summary</mat-panel-title>
                      <mat-panel-description><mat-icon>event_note</mat-icon></mat-panel-description>
                    </mat-expansion-panel-header>
                
                    <div class="form-group">
                        <table ><tr>
                            <td>                  
                              <mat-form-field class="cust-name-width">
                                <input type="text" matInput placeholder="Status" name="status"  [(ngModel)]="planningApp.planningStatus" > 
                              </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field class="cust-name-width">
                                    <input type="text" matInput placeholder="Current Status" name="currentStatus"  [(ngModel)]="planningApp.currentStateStatus"> 
                                </mat-form-field>
                            </td>                             

                         
                          </tr>
                        </table> 
                        <table ><tr>
                            <td>                  
                              <mat-form-field class="cust-name-width">
                                <input type="text" matInput placeholder="Current State" name="currentState"  [(ngModel)]="planningApp.currentState" > 
                              </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field class="cust-name-width">
                                    <input type="text" matInput placeholder="Expected State Completion Date" name="expCompletionDate"  [(ngModel)]="planningApp.expectedStateCompletionDate"> 
                                </mat-form-field>
                            </td>                             
                          </tr>
                        </table>  

                            <mat-form-field class="cust-name-width">
                                <input type="text" matInput placeholder="App Completion Date" name="appCompletionDate"  [(ngModel)]="planningApp.completionDate"> 
                            </mat-form-field>

                        <mat-form-field class="full-width">
                            <input type="text" matInput placeholder="Description" name="description"  [(ngModel)]="planningApp.name"> 
                        </mat-form-field>                                  
                    </div>
                
                    <mat-action-row>
                      <button mat-button color="primary" (click)="nextStep()">Next</button>
                    </mat-action-row>
                  </mat-expansion-panel>
                
                  <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" hideToggle>
                    <mat-expansion-panel-header>
                      <mat-panel-title>Customer Details</mat-panel-title>
                      <mat-panel-description><mat-icon>face</mat-icon></mat-panel-description>
                    </mat-expansion-panel-header>
                
                    <div class="form-group">
                        <table ><tr>
                            <td>                  
                              <mat-form-field  class="example-full-width">
                                <input type="text" matInput placeholder="First name" name="firstName"  [(ngModel)]="planningApp.customer.firstName" > 
                              </mat-form-field>
                            </td>
                            <td>
                              <mat-form-field class="example-full-width">
                                  <input type="text" matInput placeholder="Last name" name="lastName"  [(ngModel)]="planningApp.customer.lastName"> 
                              </mat-form-field>
                          </td>
                          <td>
                              <mat-form-field class="example-full-width">
                                  <input type="text" matInput placeholder="Email" name="email"  [(ngModel)]="planningApp.customer.emailAddress"> 
                              </mat-form-field>
                          </td>                          
                          </tr>
                        </table> 
                    </div>
                    <div class="form-group">
                        <table class="example-full-width" cellspacing="0"><tr>
                            <td><mat-form-field class="cust-name-width">
                              <input matInput placeholder="Address" name="address" [(ngModel)]="planningApp.customer.addressLine1"> 
                            </mat-form-field></td>

                            <td></td>
              
                            <td></td>
                          </tr>
                        </table>     
                    </div>               
                    <div class="form-group">
                      <table class="example-full-width" cellspacing="0"><tr>
                          <td><mat-form-field class="example-full-width">
                            <input matInput placeholder="City" name="city" [(ngModel)]="planningApp.customer.city"> 
                          </mat-form-field></td>
            
                          <td><mat-form-field class="example-full-width">
                            <input matInput placeholder="County" name="county" [(ngModel)]="planningApp.customer.county"> 
                          </mat-form-field></td>
            
                          <td><mat-form-field class="example-full-width">
                            <input matInput #postalCode maxlength="8" placeholder="Postal Code" value="" name="postcode" [(ngModel)]="planningApp.customer.postcode"> 
                          </mat-form-field></td>
                        </tr>
                      </table>
                    </div>

                    <div class="form-group">
                        <table class="example-full-width" cellspacing="0"><tr>
                            <td><mat-form-field class="example-full-width">
                              <input matInput placeholder="Home" name="telephoneHome" [(ngModel)]="planningApp.customer.telephoneHome"> 
                            </mat-form-field></td>
              
                            <td><mat-form-field class="example-full-width">
                              <input matInput placeholder="Work" name="Work" [(ngModel)]="planningApp.customer.telephoneWork"> 
                            </mat-form-field></td>
              
                            <td><mat-form-field class="example-full-width">
                              <input matInput placeholder="Mobile" value="" name="telephoneMobile" [(ngModel)]="planningApp.customer.telephoneMobile"> 
                            </mat-form-field></td>
                          </tr>
                        </table>
                      </div> 
                
                    <mat-action-row>
                      <button mat-button color="warn" (click)="prevStep()">Previous</button>
                      <button mat-button color="primary" (click)="nextStep()">Next</button>
                    </mat-action-row>
                  </mat-expansion-panel>
                
                  <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)" hideToggle>
                    <mat-expansion-panel-header>
                      <mat-panel-title>Developer Contact Details</mat-panel-title>
                      <mat-panel-description><mat-icon>person_outline</mat-icon></mat-panel-description>
                    </mat-expansion-panel-header>
                    <div class="form-group">
                        <table ><tr>
                            <td>                  
                              <mat-form-field class="cust-name-width">
                                <input type="text" matInput placeholder="First name" name="firstName"  [(ngModel)]="planningApp.developer.firstName" > 
                              </mat-form-field>
                            </td>
                            <td>
                              <mat-form-field class="cust-name-width">
                                  <input type="text" matInput placeholder="Last name" name="lastName"  [(ngModel)]="planningApp.developer.lastName"> 
                              </mat-form-field>
                          </td>                        
                          </tr>
                        </table> 
                    </div>              
                    <div class="form-group">
                        <table class="example-full-width" cellspacing="0"><tr>
              
                            <td><mat-form-field class="cust-name-width">
                              <input matInput placeholder="Work" name="Work" [(ngModel)]="planningApp.developer.telephoneWork"> 
                            </mat-form-field></td>
              
                            <td><mat-form-field class="cust-name-width">
                              <input matInput placeholder="Mobile" value="" name="telephoneMobile" [(ngModel)]="planningApp.developer.telephoneMobile"> 
                            </mat-form-field></td>
                          </tr>
                        </table>
                    </div>  
                    <div class="form-group">
                      <mat-form-field class="cust-name-width">
                          <input type="text" matInput placeholder="Email" name="email"  [(ngModel)]="planningApp.developer.emailAddress"> 
                      </mat-form-field>
                    </div>                                  
                    <mat-action-row>
                      <button mat-raised-button color="primary" (click)="submit()">Update</button>
                      <button mat-button color="warn" (click)="prevStep()">Previous</button>
                      <button mat-button color="primary" (click)="nextStep()">Next</button>
                    </mat-action-row>
                  </mat-expansion-panel>
                                
                  <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)" hideToggle>
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        Site Address (if different)
                      </mat-panel-title>
                      <mat-panel-description>
                        <mat-icon>business</mat-icon>
                      </mat-panel-description>
                    </mat-expansion-panel-header>

                    <div class="form-group">
                        <table ><tr>
                            <td>
                              <mat-form-field class="dev-name-width">
                                  <input type="text" matInput placeholder="Address" name="addressLine1"  [(ngModel)]="planningApp.developmentAddress.addressLine1"> 
                              </mat-form-field>
                          </td>   
                          <td>                  
                            <mat-form-field class="cust-name-width">
                              <input type="text" matInput placeholder="City" name="city"  [(ngModel)]="planningApp.developmentAddress.city" > 
                            </mat-form-field>
                          </td>                     
                          </tr>
                          <tr>
                              <td>
                                <mat-form-field class="cust-name-width">
                                    <input type="text" matInput placeholder="County" name="county"  [(ngModel)]="planningApp.developmentAddress.county"> 
                                </mat-form-field>
                            </td>    
                            <td>
                                <mat-form-field class="cust-name-width">
                                    <input type="text" matInput placeholder="Postcode" name="postcode"  [(ngModel)]="planningApp.developmentAddress.postcode"> 
                                </mat-form-field>
                            </td>                                                     
                          </tr>
                        </table> 
                    </div> 
               
                    <mat-action-row>
                      <button mat-raised-button color="primary" (click)="submit()">Update</button>
                      <button mat-button color="warn" (click)="prevStep()">Previous</button>
                    </mat-action-row>
                  </mat-expansion-panel>
                </mat-accordion>
          </div>
        </mat-tab>

        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="example-tab-icon">collections</mat-icon>
            Drawings
          </ng-template>

          Not Implemented
        </mat-tab>
        <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon class="example-tab-icon">speaker_notes</mat-icon>
              Notes
            </ng-template>
            <div class="grid-container">
              <mat-form-field class="example-full-width">
                  <textarea matInput placeholder="Application Notes"  [(ngModel)]="planningApp.notes"></textarea>
                </mat-form-field>
              </div>

              <mat-action-row>
                  <button mat-raised-button color="primary" (click)="submit()">Update</button>
                </mat-action-row>
          </mat-tab>
      </mat-tab-group>

    </div>
<div>
